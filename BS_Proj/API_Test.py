import unittest
import json
from app import app

# Set our application to test mode
app.testing = True

class TestApi(unittest.TestCase):
    """
    Testing the Api Endpoint returns status code = 200
    and non null values
    """
    def test_predict_model(self):
        """
        Testing the Api Endpoint returns status code = 200
        and non null values
        """
        with app.test_client() as client:
            sent= {
            "bitcoin_last_minute": {
                "price_open": 7173.77,
                "price_low": 7173.77,
                "price_close": 7173.77,
                "volume_traded": 0.00806387,
                "trades_count": 1,
                "price_open_-1": 7178.64,
                "price_high_-1": 7178.64,
                "price_low_-1": 7178.64,
                "price_close_-1": 7178.64,
                "volume_traded_-1": 0.06828716,
                "trades_count_-1": 1,
                "price_open_-2": 7178.64,
                "price_high_-2": 7178.64,
                "price_low_-2": 7178.64,
                "price_close_-2": 7178.64,
                "volume_traded_-2": 0.00124887,
                "trades_count_-2": 1,
                "price_open_-3": 7178.64,
                "price_high_-3": 7178.64,
                "price_low_-3": 7178.64,
                "price_close_-3": 7178.64,
                "volume_traded_-3": 0.00679323,
                "trades_count_-3": 1,
                "price_open_-4": 7179.88,
                "price_high_-4": 7179.88,
                "price_low_-4": 7179.88,
                "price_close_-4": 7179.88,
                "volume_traded_-4": 0.00962829,
                "trades_count_-4": 1,
                "price_open_-5": 7178.64,
                "price_high_-5": 7178.64,
                "price_low_-5": 7178.64,
                "price_close_-5": 7178.64,
                "volume_traded_-5": 0.01344684,
                "trades_count_-5": 1,
                "price_open_-6": 7188.18,
                "price_high_-6": 7188.18,
                "price_low_-6": 7168.34,
                "price_close_-6": 7168.34,
                "volume_traded_-6": 21,
                "trades_count_-6": 20,
                "price_open_-7": 7178.64,
                "price_high_-7": 7178.64,
                "price_low_-7": 7178.64,
                "price_close_-7": 7178.64,
                "volume_traded_-7": 0.01239581,
                "trades_count_-7": 1,
                "price_open_-8": 7178.64,
                "price_high_-8": 7178.64,
                "price_low_-8": 7178.64,
                "price_close_-8": 7178.64,
                "volume_traded_-8": 0.001872,
                "trades_count_-8": 1,
                "price_open_-9": 7180.83,
                "price_high_-9": 7180.83,
                "price_low_-9": 7180.83,
                "price_close_-9": 7180.83,
                "volume_traded_-9": 0.02021214,
                "trades_count_-9": 1,
                "price_open_-10": 7188.19,
                "price_high_-10": 7188.19,
                "price_low_-10": 7188.19,
                "price_close_-10": 7188.19,
                "volume_traded_-10": 1e-05,
                "trades_count_-10": 1,
                "price_open_-11": 7179.74,
                "price_high_-11": 7179.74,
                "price_low_-11": 7179.74,
                "price_close_-11": 7179.74,
                "volume_traded_-11": 1.00717916,
                "trades_count_-11": 2,
                "price_open_-12": 7179.74,
                "price_high_-12": 7179.74,
                "price_low_-12": 7179.74,
                "price_close_-12": 7179.74,
                "volume_traded_-12": 0.022,
                "trades_count_-12": 1,
                "price_open_-13": 7181.35,
                "price_high_-13": 7181.35,
                "price_low_-13": 7181.35,
                "price_close_-13": 7181.35,
                "volume_traded_-13": 0.0034653,
                "trades_count_-13": 1,
                "price_open_-14": 7181.35,
                "price_high_-14": 7181.35,
                "price_low_-14": 7181.35,
                "price_close_-14": 7181.35,
                "volume_traded_-14": 0.00692922,
                "trades_count_-14": 1,
                "price_open_-15": 7181.35,
                "price_high_-15": 7181.35,
                "price_low_-15": 7181.35,
                "price_close_-15": 7181.35,
                "volume_traded_-15": 0.01332362,
                "trades_count_-15": 1,
                "price_open_-16": 7181.35,
                "price_high_-16": 7181.35,
                "price_low_-16": 7181.35,
                "price_close_-16": 7181.35,
                "volume_traded_-16": 0.01332362,
                "trades_count_-16": 1,
                "price_open_-17": 7181.35,
                "price_high_-17": 7181.35,
                "price_low_-17": 7181.35,
                "price_close_-17": 7181.35,
                "volume_traded_-17": 0.0012484,
                "trades_count_-17": 1,
                "price_open_-18": 7181.35,
                "price_high_-18": 7181.35,
                "price_low_-18": 7181.35,
                "price_close_-18": 7181.35,
                "volume_traded_-18": 0.09,
                "trades_count_-18": 1,
                "price_open_-19": 7179.74,
                "price_high_-19": 7179.74,
                "price_low_-19": 7179.74,
                "price_close_-19": 7179.74,
                "volume_traded_-19": 0.01020159,
                "trades_count_-19": 1,
                "price_open_-20": 7181.54,
                "price_high_-20": 7181.54,
                "price_low_-20": 7181.54,
                "price_close_-20": 7181.54,
                "volume_traded_-20": 0.01332234,
                "trades_count_-20": 1,
                "price_open_-21": 7182.05,
                "price_high_-21": 7182.05,
                "price_low_-21": 7182.05,
                "price_close_-21": 7182.05,
                "volume_traded_-21": 0.03112843,
                "trades_count_-21": 1,
                "price_open_-22": 7188.19,
                "price_high_-22": 7188.19,
                "price_low_-22": 7188.19,
                "price_close_-22": 7188.19,
                "volume_traded_-22": 1e-05,
                "trades_count_-22": 1,
                "price_open_-23": 7182.1,
                "price_high_-23": 7182.1,
                "price_low_-23": 7182.1,
                "price_close_-23": 7182.1,
                "volume_traded_-23": 0.01332433,
                "trades_count_-23": 1,
                "price_open_-24": 7181.34,
                "price_high_-24": 7181.34,
                "price_low_-24": 7181.34,
                "price_close_-24": 7181.34,
                "volume_traded_-24": 0.00222652,
                "trades_count_-24": 1,
                "price_open_-25": 7179.74,
                "price_high_-25": 7179.74,
                "price_low_-25": 7179.74,
                "price_close_-25": 7179.74,
                "volume_traded_-25": 0.00712875,
                "trades_count_-25": 1,
                "price_open_-26": 7179.74,
                "price_high_-26": 7179.74,
                "price_low_-26": 7179.74,
                "price_close_-26": 7179.74,
                "volume_traded_-26": 0.00798902,
                "trades_count_-26": 1,
                "price_open_-27": 7180.96,
                "price_high_-27": 7180.96,
                "price_low_-27": 7180.96,
                "price_close_-27": 7180.96,
                "volume_traded_-27": 0.03534325,
                "trades_count_-27": 1,
                "price_open_-28": 7188.19,
                "price_high_-28": 7188.19,
                "price_low_-28": 7188.19,
                "price_close_-28": 7188.19,
                "volume_traded_-28": 0.04090867,
                "trades_count_-28": 1,
                "price_open_-29": 7188.19,
                "price_high_-29": 7188.19,
                "price_low_-29": 7188.19,
                "price_close_-29": 7188.19,
                "volume_traded_-29": 1e-05,
                "trades_count_-29": 1,
                "price_open_-30": 7185.37,
                "price_high_-30": 7185.37,
                "price_low_-30": 7185.37,
                "price_close_-30": 7185.37,
                "volume_traded_-30": 0.00672739,
                "trades_count_-30": 1,
                "price_open_-31": 7183.6,
                "price_high_-31": 7183.6,
                "price_low_-31": 7183.6,
                "price_close_-31": 7183.6,
                "volume_traded_-31": 0.0276756,
                "trades_count_-31": 2,
                "price_open_-32": 7183.29,
                "price_high_-32": 7183.29,
                "price_low_-32": 7183.29,
                "price_close_-32": 7183.29,
                "volume_traded_-32": 0.03343442,
                "trades_count_-32": 1,
                "price_open_-33": 7182.8,
                "price_high_-33": 7183.7,
                "price_low_-33": 7182.8,
                "price_close_-33": 7183.7,
                "volume_traded_-33": 0.4,
                "trades_count_-33": 3,
                "price_open_-34": 7183.29,
                "price_high_-34": 7183.29,
                "price_low_-34": 7183.29,
                "price_close_-34": 7183.29,
                "volume_traded_-34": 0.00297955,
                "trades_count_-34": 1,
                "price_open_-35": 7183.29,
                "price_high_-35": 7183.29,
                "price_low_-35": 7183.29,
                "price_close_-35": 7183.29,
                "volume_traded_-35": 0.00664773,
                "trades_count_-35": 1,
                "price_open_-36": 7183.29,
                "price_high_-36": 7183.5,
                "price_low_-36": 7183.29,
                "price_close_-36": 7183.5,
                "volume_traded_-36": 0.30277038,
                "trades_count_-36": 3,
                "price_open_-37": 7183.29,
                "price_high_-37": 7183.29,
                "price_low_-37": 7183.29,
                "price_close_-37": 7183.29,
                "volume_traded_-37": 0.00374141,
                "trades_count_-37": 1,
                "price_open_-38": 7182.7,
                "price_high_-38": 7182.7,
                "price_low_-38": 7182.7,
                "price_close_-38": 7182.7,
                "volume_traded_-38": 0.02796803,
                "trades_count_-38": 1,
                "price_open_-39": 7182.7,
                "price_high_-39": 7182.7,
                "price_low_-39": 7182.7,
                "price_close_-39": 7182.7,
                "volume_traded_-39": 0.02796804,
                "trades_count_-39": 1,
                "price_open_-40": 7182.7,
                "price_high_-40": 7182.7,
                "price_low_-40": 7182.7,
                "price_close_-40": 7182.7,
                "volume_traded_-40": 0.02796802,
                "trades_count_-40": 2,
                "price_open_-41": 7184.86,
                "price_high_-41": 7184.86,
                "price_low_-41": 7181.17,
                "price_close_-41": 7181.17,
                "volume_traded_-41": 0.17182591,
                "trades_count_-41": 2,
                "price_open_-42": 7183.29,
                "price_high_-42": 7183.29,
                "price_low_-42": 7183.29,
                "price_close_-42": 7183.29,
                "volume_traded_-42": 0.0272897,
                "trades_count_-42": 1,
                "price_open_-43": 7188.18,
                "price_high_-43": 7188.18,
                "price_low_-43": 7188.18,
                "price_close_-43": 7188.18,
                "volume_traded_-43": 0.01084745,
                "trades_count_-43": 1,
                "price_open_-44": 7183.29,
                "price_high_-44": 7183.29,
                "price_low_-44": 7183.29,
                "price_close_-44": 7183.29,
                "volume_traded_-44": 0.00932172,
                "trades_count_-44": 1,
                "price_open_-45": 7183.3,
                "price_high_-45": 7183.3,
                "price_low_-45": 7183.3,
                "price_close_-45": 7183.3,
                "volume_traded_-45": 0.00276937,
                "trades_count_-45": 1,
                "price_open_-46": 7185.9,
                "price_high_-46": 7185.9,
                "price_low_-46": 7185.39,
                "price_close_-46": 7185.39,
                "volume_traded_-46": 0.42699303,
                "trades_count_-46": 6,
                "price_open_-47": 7185.91,
                "price_high_-47": 7185.91,
                "price_low_-47": 7185.91,
                "price_close_-47": 7185.91,
                "volume_traded_-47": 0.00138465,
                "trades_count_-47": 1,
                "price_open_-48": 7188.32,
                "price_high_-48": 7188.32,
                "price_low_-48": 7185.9,
                "price_close_-48": 7185.9,
                "volume_traded_-48": 0.27890216,
                "trades_count_-48": 4,
                "price_open_-49": 7185.91,
                "price_high_-49": 7185.91,
                "price_low_-49": 7185.91,
                "price_close_-49": 7185.91,
                "volume_traded_-49": 0.01343323,
                "trades_count_-49": 1,
                "price_open_-50": 7185.91,
                "price_high_-50": 7185.91,
                "price_low_-50": 7185.91,
                "price_close_-50": 7185.91,
                "volume_traded_-50": 0.03410841,
                "trades_count_-50": 1,
                "price_open_-51": 7181.17,
                "price_high_-51": 7181.17,
                "price_low_-51": 7181.17,
                "price_close_-51": 7181.17,
                "volume_traded_-51": 0.0151457,
                "trades_count_-51": 2,
                "price_open_-52": 7185.91,
                "price_high_-52": 7185.91,
                "price_low_-52": 7185.91,
                "price_close_-52": 7185.91,
                "volume_traded_-52": 0.03994689,
                "trades_count_-52": 1,
                "price_open_-53": 7185.91,
                "price_high_-53": 7185.91,
                "price_low_-53": 7185.91,
                "price_close_-53": 7185.91,
                "volume_traded_-53": 0.00325498,
                "trades_count_-53": 1,
                "price_open_-54": 7185.9,
                "price_high_-54": 7185.9,
                "price_low_-54": 7185.9,
                "price_close_-54": 7185.9,
                "volume_traded_-54": 0.05270953,
                "trades_count_-54": 1,
                "price_open_-55": 7185.91,
                "price_high_-55": 7185.91,
                "price_low_-55": 7181.17,
                "price_close_-55": 7181.17,
                "volume_traded_-55": 0.01091308,
                "trades_count_-55": 2,
                "price_open_-56": 7181.17,
                "price_high_-56": 7185.91,
                "price_low_-56": 7181.17,
                "price_close_-56": 7185.91,
                "volume_traded_-56": 0.38317517,
                "trades_count_-56": 3,
                "price_open_-57": 7185.91,
                "price_high_-57": 7185.91,
                "price_low_-57": 7185.91,
                "price_close_-57": 7185.91,
                "volume_traded_-57": 0.00360157,
                "trades_count_-57": 1,
                "price_open_-58": 7185.91,
                "price_high_-58": 7185.91,
                "price_low_-58": 7185.91,
                "price_close_-58": 7185.91,
                "volume_traded_-58": 0.00214765,
                "trades_count_-58": 1,
                "price_open_-59": 7185.9,
                "price_high_-59": 7185.9,
                "price_low_-59": 7185.9,
                "price_close_-59": 7185.9,
                "volume_traded_-59": 0.01025706,
                "trades_count_-59": 1
            }
        }
            # post json data to the endpoint
            result = client.post('/predict',data = json.dumps(sent),content_type='application/json')
            data = result.get_data(as_text=True)
            # Assert that we get the status code 200,which indicates a success
            self.assertEqual(result.status_code,200)
            # Assert the result is not None(null)
            self.assertIsNotNone(data)


# Programmatically building up the Test_Api TestSuite
run_tests = unittest.TestLoader().loadTestsFromTestCase(TestApi)
# call the TestRunner with the verbosity 2
unittest.TextTestRunner(verbosity=2).run(run_tests)
